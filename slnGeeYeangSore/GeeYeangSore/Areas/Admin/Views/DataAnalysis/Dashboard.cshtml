@model GeeYeangSore.ViewModels.DataAnalysisViewModel
@{
    ViewData["Title"] = "數據分析";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    .card-custom {
        background-color: #3CDDD2;
        color: white;
        border: none;
        height: 180px;
        transition: background-color 0.3s ease;
    }

    .card-custom:hover {
        background-color: #24B4A8;
    }

    .chart-container {
        height: 300px;
    }

    .chart-wrapper {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        height: 100%;
    }
</style>

<div class="container py-4">
    <h2 class="mb-4">數據分析儀表板</h2>


    <!-- 1st row -->
    <div class="row g-4 mb-4">
        <div class="col-md-7">
            <div class="chart-wrapper p-3">
                <h5 class="card-title fw-bold mb-5">平台數據概況</h5>
                <div class="row g-3">
                    <div class="col-md-6 col-lg-3">
                        <div class="card card-custom p-3 text-center">
                            <h6>總房源數</h6>
                            <h4>@(Model.SharedPropertiesCount + Model.NonSharedPropertiesCount)</h4>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card card-custom p-3 text-center">
                            <h6>總合租數</h6>
                            <h4>@Model.SharedPropertiesCount</h4>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card card-custom p-3 text-center">
                            <h6>總用戶人數</h6>
                            <h4>@Model.TotalUsers</h4>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card card-custom p-3 text-center">
                            <h6>總收益</h6>
                            <h4>$@Model.TotalRevenue.ToString("N0")</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="chart-wrapper">
                <canvas id="revenueLineChart" class="chart-container"></canvas>
            </div>
        </div>
    </div>

    <!-- 2nd row -->
    <div class="row g-4">
        <div class="col-md-6">
            <div class="chart-wrapper">
                <canvas id="propertyByDistrictChart" class="chart-container"></canvas>
            </div>
        </div>
        <div class="col-md-3">
            <div class="chart-wrapper">
                <canvas id="userPieChart" class="chart-container"></canvas>
            </div>
        </div>
        <div class="col-md-3">
            <div class="chart-wrapper">
                <canvas id="rentalTypePieChart" class="chart-container"></canvas>
            </div>
        </div>
    </div>
</div>

<script>

    // 用戶分布圓餅圖
    new Chart(document.getElementById('userPieChart'), {
        type: 'pie',
        data: {
            labels: ['房東', '房客'],
            datasets: [{
                data: [@Model.TotalLandlords, @Model.TotalTenants],
                backgroundColor: ['#3CDDD2', '#24B4A8']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });

    // 合租分布圓餅圖
    new Chart(document.getElementById('rentalTypePieChart'), {
        type: 'pie',
        data: {
            labels: ['合租', '一般租房'],
            datasets: [{
                data: [@Model.SharedPropertiesCount, @Model.NonSharedPropertiesCount],
                backgroundColor: ['#3CDDD2', '#24B4A8']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });

    // 地區柱狀圖
    const districtLabels = @Html.Raw(Json.Serialize(Model.PropertiesByDistrict.Keys));
    const districtCounts = @Html.Raw(Json.Serialize(Model.PropertiesByDistrict.Values));

        new Chart(document.getElementById('propertyByDistrictChart'), {
        type: 'bar',
        data: {
            labels: districtLabels,
            datasets: [{
                label: '地區房源數',
                data: districtCounts,
                backgroundColor: '#24B4A8'
            }]
        }
    });

    // 收益折線圖
        const months = @Html.Raw(Json.Serialize(Model.MonthlyRevenueData.Select(m => m.Month)));
    const revenues = @Html.Raw(Json.Serialize(Model.MonthlyRevenueData.Select(m => m.Revenue)));

    new Chart(document.getElementById('revenueLineChart'), {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label: '平台收益',
                data: revenues,
                borderColor: '#3CDDD2',
                fill: false
            }]
        }
    });
</script>

